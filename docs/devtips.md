
cmake build with debug info included

    build/ $ cmake -DCMAKE_CXX_FLAGS="-g2"  ..
    
    
BoxMap

Πίνακας  2D. Η κάθε θέση του έχει ένα Sprite*. Περιοδικά μετακινούνται όλα τα κομμάτια μία θέση αριστερά και εισάγεται μία νέα στήλη από τα δεξιά.

Θέλουμε να ενθυλακώσουμε το animation κάθε κομματιού σε ένα ξεχωριστό module. Ενα module που θα παίρνει

* Ένα sprite* που θα μετακινηθεί. Αυτό μπορεί να βρίσκεται μέσα στο BoxMap ή όχι.
* Την τελική θέση σε επίπεδο απολυτων συντεταγμένων x/y (στο ίσιο σύστημα αναφοράς με τα Sprite.x/y)
* Τον αριθμό των βημάτων/ticks εάν προκειται για γραμμική μετακίνηση. Σε πόσους κύκλους θέλουμε να γίνει η μετακίνηση
  ή μια συνάρτηση με βάση τα ticks που θα δείνει την τροχιά του καθώς και μία συνθήκη τέλους του animation
* Optional. Έναν handler που θα κληθεί όταν τερματίσει το animation.

Είναι σημαντικό

* Τα Sprite* που περιέχει το BoxMap έχουν δύο ζευγάρια συντεταγμένες. Το ένα αφορά τη _θέση_ του sprite στο BoxMap όταν προβληθεί στην οθόνη, Το δεύτερο τη πραγματική θέση του Sprite. Αυτές δεν είναι κατ'ανάγκη ίδιες. Είναι ίδιες όταν το sprite είναι σε "ισορροπία". Όταν δεν κινείται, δεν εισάγεται στο Map, ή ίσως, και όταν δεν αποχωρεί. Το spite τυπώνεται πάντα στις δικές του συντεταγμένες (αυτές που περιέχει η δομή Sprite) αλλά υπάρχουν και οι συντεταγμένες ισοροπίας όταν αυτό ηρεμεί σε κάποια θέση στο BoxMap.
* όταν ξεκινά το animation, το Sprite* φεύγει από τη τρέχουσα θέση του στον BoxMap και τοποθετείται στην τελική του θέση στον ίδιο πίνακα. Άμεσα. Προφανώς, όταν μετακινείται ολόκληρο block από κομμάτια πρέπει η φορά που θα τοποθετούνται τα κομμάτια  να είναι αντίθετη από τη μετακίνηση καθαυτή. Δηλαδή, εάν μετακινούνται τα κομμάτια αριστέρα, να ξεκινάς από τα αυτό που βρίσκονται αριστερά και σταδιακά αυτά που βρίσκονται δεξιότερα.

Επίσης, πρέπει να δηλωθεί κλάση handler. Να έχει μία μέθοδο handle(EventType, int64 passByValue)


### Simulations

Period - μετακίνηση αριστερά

* BoxMap: γίνεται πέρασμα στον πίνακα boxes. Σαρώνονται οι στήλες από αριστερά προς τα δεξιά. Κάθε στοιχείο μιας στήλης τοποθετείται στην αριστερή του θέση εάν αυτή είναι κενή ή χάνει ο παίκτης (game over) εάν βγαίνει εκτός πίνακα. Εάν είναι γεμάτη έχουμε σφάλμα εφαρμογής. Μετά τη μετακίνηση ενός κομματιού στήνεται και το animation. Αρχικοποιείται ένα άδειο slot στον πίνακα Animations.animators, παίρνει το Sprite* και, υπολογίζονται οι τελικές συντεταγμένες. Δεν βλέπω το λόγο να σηκωθεί κάποιο event για την ώρα. Για τα κομμάτια που εισάγονται από τη δεξιά μεριά, έχουμε άμεση τοποθέτηση στην δεξιότεερη στήλη του BoxMap. Οι αριχικές συντεταγμένες ωστόστο του Sprite του κομματιού είναι "χωροταξικά" ένα βήμα δεξιότερα.

* Διαγραφή κομματιού - κλικάρισμα

Ο χρήστης πατά ένα κομμάτι στο BoxMap. Ελέγχονται αυτό το κομμάτι (εάν πράγματι υπάρχει κάτι σε αυτή τη θέση) και όλα τα γιτονικά (ανδρομικά;) που έχουν το ίδιο χρώμα. Εάν αριθμητικά είναι πάνω από 2, ενεργοποιείται η διαδικασία αφαίρεσης. Για κάθε νεά από αυτά τα κομμάτια ξεκινά ένα animation από την τρέχουσα θέση του, Στο κάτω μέρος της οθόνης και αφαιρείται από το BoxMap. Ακόμα δεν πέφτει τίποτα. 

* Πτώσεις

Μετά και από τη φάση της διαγραφής σαρώνεται όλος ο BoxMap ανά στήλη από κάτω προς τα πάνω και όπου υπάρχει κενό τα ανώτερα κομμάτια "πέφτουν" να το κλείσουν. Για κάθε στήλη, ξεκινάμε από κάτω θεωρώντας πως έχουμε ήδη βρει γεμάτο tile. Ψάχνουμε για άδειο κινούμενοι προς τα πάνω και μετράμε κενά. Μόλις βρούμε γεμάτο, το μεταφέρουμε στο πρώτο άδειο. Ξαναξινάμε το μέτρημα προς τα πάνω από το επόμενο tile (άδειο). 

για τα animation, Θα μπορούσαμε για να προσπαρμόσουμε τα βήματα τους έτσι ώστε η ταχύτητα να είναι ανεξάρτητη από το ύψος που θα πέσουν.


 Σημειώνεται το γεγονός πως είχαμε πτώση στη στήλη αυτή και ο αριθμός των κομματιών που πέφτουν - FALLING_COUNT. Κάθε κομμάτι που φτάνει στον προορισμό του μειώνει το FALLING_COUNT της στήλης του. Ο πίνακας ξανασαρώνεται για πτώσεις. Οι στήλες που έχουν FALLING_COUNT>0 αγνοούνται μέχρι να ηρεμήσουν (FALLING_COUNT==0). Ξανασαρώνονται όταν είναι ήρεμες και αν διαπιστωθεί κενό η διαδικασία της πτώσης για τη στήλη ενεργοποιείται εκ νέου.

### Discard algorithm

Click on a Box
Check if top/left/right/bottom have same color
If any of them has same color

> recursion unit (x,y, &discardedCount, prevColor) <
curColor = color(x,y)
if (emptyTile)
    return
else if (curColor == prevColor)
    map(x,y) = 0
    discarded ++;
    recursion_unit(x-1,y,curColor)
    recursion_unit(x-1, y-1, curColor)
    recursion_unit(x+1, y, curColor)
    recursion_unit(x+1, y+1, curColor)
else if (prevColor == notGiven)
    recursion_unit(x-1,y,curColor)
    recursion_unit(x-1, y-1, curColor)
    recursion_unit(x+1, y, curColor)
    recursion_unit(x+1, y+1, curColor)
end    




ADDED


TODO

* visibility, class/struct public/private model still needs some thinking
* extended logging information produced

